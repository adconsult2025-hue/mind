<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MIND — Suite</title>
  <link rel="icon" href="/assets/img/mind.png">
  <link rel="stylesheet" href="/assets/css/style.css?v=42"/>
  <script src="/config/firebase-config.js"></script>
<script type="module" src="/assets/js/app.js?v=42"></script>
  <script type="module" src="/assets/js/preventivi.js?v=41"></script>
  <script type="module" src="/assets/js/firebase-init.js"></script>
</head>
<body class="dark">
  <header class="app-header">
    <div class="brand">
      <a href="/" class="brand-link">
        <img class="logo" src="/assets/img/mind.png" alt="MIND">
      </a>
      <div class="titles">
        <h1>Preventivi &amp; Proposte</h1>
        <p class="subtitle">Gestisci pipeline commerciale, scadenze e collegamenti ai moduli</p>
      </div>
    </div>
    <div class="header-actions">
      <nav class="toolbar main-nav">
        <a class="btn nav-item" data-module="crm" href="/modules/crm/index.html">CRM</a>
        <a class="btn nav-item" data-module="cer" href="/modules/cer/index.html">CER</a>
        <a class="btn nav-item" data-module="impianti" href="/modules/impianti/index.html">IMPIANTI</a>
        <a class="btn nav-item" data-module="modelli" href="/modules/modelli/index.html">MODELLI &amp; CONTRATTI</a>
        <a class="btn nav-item" data-module="preventivi" href="/modules/preventivi/index.html">PREVENTIVATORE</a>
        <a class="btn nav-item" data-module="ct3" href="/modules/ct3/index.html">CT 3.0</a>
        <a class="btn nav-item" data-module="simulatori" href="/modules/simulatori/index.html">SIMULATORE</a>
        <a class="btn ghost" href="/">HUB</a>
      </nav>
      <div class="session-controls" aria-live="polite" data-session-controls></div>
    </div>
  </header>

  <main class="container wide preventivi-layout" data-requires-any-role="preventivi">
    <section class="card hero">
      <h2>Pipeline preventivi unificata</h2>
      <p>Questa vista raccoglie opportunità provenienti da CRM, simulatori e moduli CT3.0: puoi monitorare importi, probabilità di chiusura, scadenze e attività successive senza uscire dalla suite.</p>
      <ul>
        <li><strong>Sincronizzazione</strong> con anagrafiche CRM e POD collegati.</li>
        <li><strong>Integrazione</strong> con modelli contrattuali per generare bozze a partire dal preventivo approvato.</li>
        <li><strong>Alert</strong> automatici su scadenze, firme mancanti e revisioni richieste.</li>
      </ul>
      <p class="note">I dati mostrati sono demo locale. L&rsquo;integrazione con backend e storage documentale avverrà nel deploy Netlify collegato.</p>
    </section>

    <section class="grid-2">
      <section class="card">
        <div class="preventivi-table-meta">
          <div>
            <h2>Pipeline preventivi</h2>
            <p class="info-text">Monitora lo stato delle offerte e coordina le prossime azioni operative.</p>
          </div>
          <div class="actions">
            <button class="btn" type="button" id="btn-new-quote">Nuovo preventivo</button>
            <button class="btn ghost" type="button" id="btn-export-preventivi">Esporta CSV</button>
          </div>
        </div>

        <div class="filters preventivi-filters">
          <button class="tab-btn" type="button" data-filter="all">Tutti</button>
          <button class="tab-btn" type="button" data-filter="pipeline">In pipeline</button>
          <button class="tab-btn" type="button" data-filter="won">Vinti</button>
          <button class="tab-btn" type="button" data-filter="lost">Persi</button>
        </div>

        <div class="preventivi-metrics" id="preventivi-metrics"></div>

        <div class="table-wrap mt-4">
          <table class="data-table" id="preventivi-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Ambito</th>
                <th>Valore</th>
                <th>Probabilità</th>
                <th>Stato</th>
                <th>Aggiornato</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p class="note" id="preventivi-count"></p>
      </section>

      <aside class="card soft preventivo-detail" id="preventivo-detail">
        <header>
          <h2>Dettaglio preventivo</h2>
          <p class="info-text" id="preventivo-subtitle">Seleziona un preventivo per vedere stato, importi e prossime azioni.</p>
        </header>

        <div class="preventivo-empty" id="preventivo-empty">
          Seleziona un preventivo dalla tabella per aprire il dettaglio operativo.
        </div>

        <div class="detail-content" id="preventivo-content" hidden>
          <div class="badge-row">
            <span class="status-badge" id="preventivo-status"></span>
            <span class="badge muted" id="preventivo-probability"></span>
            <span class="badge" id="preventivo-validity"></span>
          </div>

          <dl class="detail-list">
            <div>
              <dt>Cliente</dt>
              <dd id="preventivo-customer"></dd>
            </div>
            <div>
              <dt>Segmento</dt>
              <dd id="preventivo-segment"></dd>
            </div>
            <div>
              <dt>Ambito</dt>
              <dd id="preventivo-scope"></dd>
            </div>
            <div>
              <dt>Valore preventivo</dt>
              <dd id="preventivo-amount"></dd>
            </div>
            <div>
              <dt>Referente</dt>
              <dd id="preventivo-owner"></dd>
            </div>
            <div>
              <dt>Aggiornato</dt>
              <dd id="preventivo-updated"></dd>
            </div>
          </dl>

          <section>
            <h3>Prossime azioni</h3>
            <ul class="preventivo-actions" id="preventivo-actions"></ul>
          </section>

          <section>
            <h3>Timeline attività</h3>
            <ul class="preventivo-history" id="preventivo-history"></ul>
          </section>

          <section>
            <h3>Note operative</h3>
            <p id="preventivo-notes" class="info-text"></p>
          </section>
        </div>
      </aside>
    </section>
  </main>
</body>
</html>
